{{define "search"}}
{{$lang := .Lang}}

<!-- Search Page Template -->
<section class="section">
    <div class="container">
        <!-- Hero Section -->
        <div class="hero is-primary is-small has-hero-bg">
            <div class="hero-body">
                <div class="container has-text-centered">
                    <h1 class="title is-2 has-text-white mb-2">
                        <span class="icon-text">{{index .t "Search.Title"}}</span>
                    </h1>
                    <p class="subtitle has-text-white mb-2">
                        {{index .t "Search.Subtitle"}}
                    </p>
                </div>
            </div>
        </div>
        <div class="columns is-centered">
            <div class="column is-10 welcome-block">
                <!-- Search Form Card -->
                <form action="/search?lang={{$lang}}" method="POST" class="form-container">
                    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                    <div class="columns is-multiline">
                        <div class="column is-6-desktop">
                            <div class="field">
                                <label class="label has-text-weight-semibold" for="vmid">
                                    {{index .t "Search.VMID"}}
                                </label>
                                <div class="control">
                                    <input class="input is-medium" 
                                           type="number" 
                                           id="vmid" 
                                           name="vmid" 
                                           placeholder="{{index .t "Search.PlaceholderVMID"}}"
                                           min="1" 
                                           max="999999"
                                           {{if .FormData.vmid}}value="{{.FormData.vmid}}"{{end}}>
                                </div>
                                <p id="vmid-help" class="help has-text-grey">
                                    <small>{{index .t "Search.TitleVMID"}}</small>
                                </p>
                            </div>
                        </div>
                        <div class="column is-6-desktop">
                            <div class="field">
                                <label class="label has-text-weight-semibold" for="name">
                                    {{index .t "Search.Name"}}
                                </label>
                                <div class="control">
                                    <input class="input is-medium" 
                                           type="text" 
                                           id="name" 
                                           name="name" 
                                           placeholder="{{index .t "Search.PlaceholderName"}}"
                                           maxlength="100"
                                           {{if .FormData.name}}value="{{.FormData.name}}"{{end}}>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="field is-grouped is-grouped-centered mt-5">
                        <div class="control">
                            <button type="submit" class="button is-primary is-medium has-text-weight-semibold">
                                {{index .t "Search.Submit"}}
                            </button>
                        </div>
                        <div class="control">
                            <a href="/search?lang={{$lang}}" class="button is-light is-medium">
                                {{index .t "Search.Clear"}}
                            </a>
                        </div>
                    </div>
                </form>
                <!-- RÃ©sultats de recherche -->
                {{if .Query}}
                <div class="section">
                    <div class="container">
                        <h2 class="title is-4 has-text-centered mb-5">
                            {{index .t "Search.ResultsFor"}} "{{.Query}}"
                        </h2>
                        {{if .Results}}
                        <div class="table-container">
                            <div class="level is-mobile mb-4">
                                <div class="level-left">
                                    <div class="level-item">
                                        <span class="tag is-info is-light">{{len .Results}} {{index .t "Search.ResultsFound"}}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="table-wrapper" id="tableView">
                                <table class="table is-fullwidth is-hoverable">
                                    <thead>
                                        <tr>
                                            <th class="has-text-centered">{{index .t "Search.VMID"}}</th>
                                            <th class="has-text-centered">{{index .t "Search.Name"}}</th>
                                            <th class="has-text-centered">{{index .t "Search.Node"}}</th>
                                            <th class="has-text-centered">{{index .t "Search.Status"}}</th>
                                            <th class="has-text-centered">{{index .t "Search.Actions"}}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {{range .Results}}
                                        <tr>
                                            <td class="has-text-weight-bold">
                                                <span class="tag is-primary is-light">{{printf "%.0f" .vmid}}</span>
                                            </td>
                                            <td>{{.name}}</td>
                                            <td><span class="tag is-info is-light">{{.node}}</span></td>
                                            <td>{{.status}}</td>
                                            <td>
                                                <a href="/vm/details/{{.vmid}}?lang={{$lang}}" class="button is-small is-link">{{index $.t "Search.View"}}</a>
                                            </td>
                                        </tr>
                                        {{end}}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {{else if .NoResults}}
                        <div class="notification is-warning is-light">
                            <div class="content has-text-centered">
                                <p class="is-size-5 has-text-weight-semibold mt-3">{{index .t "Search.NoResults"}}</p>
                                <p class="has-text-grey">{{index .t "Search.NoResultsMessage"}}</p>
                            </div>
                        </div>
                        {{end}}
                    </div>
                </div>
                {{end}}
                <!-- Error Messages -->
                {{if .Error}}
                <div class="notification is-danger is-light">
                    <div class="content has-text-centered">
                        <p class="is-size-5 has-text-weight-semibold mt-3">{{.Error}}</p>
                    </div>
                </div>
                {{end}}
            </div>
        </div>
    </div>
</section>

<style>
.vm-id-badge {
    background: #FF8800;
    color: white;
    width: 48px;
    height: 48px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
}

.vm-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

@media (max-width: 768px) {
    .container {
        padding: 0 1rem;
    }
    
    .table-wrapper {
        overflow-x: auto;
    }
    
    .table {
        font-size: 0.875rem;
    }
    
    .tag:not(body) {
        font-size: 0.75rem;
    }
}

.table-wrapper {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.table th {
    background: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
}

.table td {
    vertical-align: middle;
}

.table tr:hover {
    background-color: #f8f9fa;
}

@media (max-width: 1024px) {
    .table-wrapper {
        overflow-x: auto;
    }
}

/* Toggle button active state */
.button.is-active {
    background-color: #3273dc;
    color: white;
}

/* Responsive table improvements */
@media screen and (max-width: 768px) {
    .table th,
    .table td {
        padding: 0.5rem;
    }
    
    .vm-id-badge {
        width: 36px;
        height: 36px;
        font-size: 1rem;
    }
}

/* View toggle functionality */
.is-hidden {
    display: none !important;
}

/* Enhanced card view for mobile */
@media screen and (max-width: 768px) {
    .vm-card {
        margin-bottom: 1rem;
    }
    
    .vm-card .card-content {
        padding: 1rem;
    }
}

/* Smooth transitions */
.table-wrapper,
.columns {
    transition: all 0.3s ease;
}
</style>

<script>
function toggleView() {
    const tableView = document.getElementById('tableView');
    const cardView = document.getElementById('cardView');
    const toggleBtn = document.getElementById('viewToggleBtn');
    
    if (tableView.classList.contains('is-hidden')) {
        // Show table view
        tableView.classList.remove('is-hidden');
        cardView.classList.add('is-hidden');
        toggleBtn.innerHTML = `
            <span>{{index .t "Search.CardView"}}</span>
        `;
    } else {
        // Show card view
        tableView.classList.add('is-hidden');
        cardView.classList.remove('is-hidden');
        toggleBtn.innerHTML = `
            <span>{{index .t "Search.TableView"}}</span>
        `;
    }
}
</script>
{{end}}