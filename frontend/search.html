{{define "search"}}
{{$lang := .Lang}}

<section class="section">
    <div class="container">
        <!-- Page Header -->
        <div class="level mb-5">
            <div class="level-left">
                <div class="level-item">
                    <h1 class="title is-3">
                        <span class="icon-text">
                            <span class="icon has-text-primary">
                                <i class="fas fa-magnifying-glass"></i>
                            </span>
                            <span>{{T "Search.Title"}}</span>
                        </span>
                    </h1>
                </div>
            </div>
            <div class="level-right">
                <div class="level-item">
                    <div class="buttons">
                        <a href="/vm/create" class="button is-primary">
                            <span class="icon"><i class="fas fa-plus-square"></i></span>
                            <span>{{T "Profile.CreateVM"}}</span>
                        </a>
                        <a href="/profile" class="button is-link is-light">
                            <span class="icon"><i class="fas fa-user"></i></span>
                            <span>{{T "Profile.MyProfile"}}</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Form Card -->
        <div class="card mb-5">
            <header class="card-header brand-header">
                <p class="card-header-title">
                    <span class="icon-text">
                        <span class="icon"><i class="fas fa-filter"></i></span>
                        <span>{{T "Search.Criterias"}}</span>
                    </span>
                </p>
            </header>
            <div class="card-content">
                <p class="mb-4 has-text-grey">{{T "Search.Subtitle"}}</p>
                <form action="/search" method="POST">
                    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                    <div class="columns is-variable is-6">
                        <div class="column is-6">
                            <div class="field">
                                <label class="label has-text-weight-semibold" for="vmid">
                                    <span>{{T "Search.VMID"}}</span>
                                </label>
                                <div class="control has-icons-left">
                                    <input class="input is-medium" type="number" id="vmid" name="vmid" inputmode="numeric" autocomplete="off" placeholder="{{T "Search.PlaceholderVMID"}}" min="1" max="999999999" {{if .FormData.vmid}}value="{{.FormData.vmid}}" {{end}}>
                                    <span class="icon is-small is-left">
                                        <i class="fas fa-hashtag"></i>
                                    </span>
                                </div>
                                <p id="vmid-help" class="help has-text-grey">
                                    <small>{{T "Search.TitleVMID"}}</small>
                                </p>
                            </div>
                        </div>
                        <div class="column is-6">
                            <div class="field">
                                <label class="label has-text-weight-semibold" for="name">
                                    <span>{{T "Search.Name"}}</span>
                                </label>
                                <div class="control has-icons-left">
                                    <input class="input is-medium" type="text" id="name" name="name" autocomplete="off" placeholder="{{T "Search.PlaceholderName"}}" maxlength="100" {{if .FormData.name}}value="{{.FormData.name}}" {{end}}>
                                    <span class="icon is-small is-left">
                                        <i class="fas fa-tag"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="field is-grouped is-grouped-right">
                        <div class="control">
                            <a href="/search" class="button is-light is-medium">
                                <span class="icon"><i class="fas fa-eraser"></i></span>
                                <span>{{T "Search.Clear"}}</span>
                            </a>
                        </div>
                        <div class="control">
                            <button type="submit" class="button is-primary is-medium">
                                <span class="icon"><i class="fas fa-search"></i></span>
                                <span>{{T "Search.Submit"}}</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Search Results -->
        {{if .Query}}
        <div class="card">
            <header class="card-header brand-header">
                <p class="card-header-title">
                    <span class="icon-text">
                        <span class="icon"><i class="fas fa-list"></i></span>
                        <span>{{T "Search.ResultsFor"}} "{{.Query}}"</span>
                    </span>
                </p>
            </header>
            <div class="card-content">
                {{if .Results}}
                <div class="table-container">
                    <table class="table is-fullwidth is-hoverable">
                        <thead>
                            <tr class="has-background-light">
                                <th class="has-text-centered" width="100">
                                    <span>{{T "Search.VMID"}}</span>
                                </th>
                                <th>
                                    <span>{{T "Search.Name"}}</span>
                                </th>
                                <th>
                                    <span>{{T "Search.Description"}}</span>
                                </th>
                                <th class="has-text-centered" width="150">
                                    <span>{{T "Search.Node"}}</span>
                                </th>
                                <th class="has-text-centered" width="150">
                                    <span>{{T "Search.Status"}}</span>
                                </th>
                                <th class="has-text-centered" width="150">
                                    <span>{{T "Search.Actions"}}</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range .Results}}
                            <tr class="is-vcentered">
                                <td class="has-text-centered">
                                    <span class="tag is-light is-medium has-text-weight-bold">{{.vmid}}</span>
                                </td>
                                <td>
                                    <div class="is-flex is-align-items-center">
                                        <span class="has-text-weight-semibold">{{if .name}}{{.name}}{{else}}<em class="has-text-grey-light">{{T "Search.NoName"}}</em>{{end}}</span>
                                    </div>
                                </td>
                                <td>
                                    <span>{{if .description}}{{.description}}{{else}}<em class="has-text-grey-light">{{T "Search.NoDescription"}}</em>{{end}}</span>
                                </td>
                                <td class="has-text-centered">
                                    <span class="tag is-medium">
                                        <span>{{.node}}</span>
                                    </span>
                                </td>
                                <td class="has-text-centered">
                                    {{template "status_badge" (dict "Status" .status "WithIcon" true "Size" "medium")}}
                                </td>
                                <td class="has-text-centered">
                                    <a href="{{printf "/vm/details/%d" .vmid}}" class="button is-small is-primary">
                                        <span class="icon"><i class="fas fa-eye"></i></span>
                                        <span>{{T "Search.Details"}}</span>
                                    </a>
                                </td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
                {{else if .NoResults}}
                {{template "notification" (dict 
                  "Type" "warning" 
                  "Title" (T "Search.NoResults") 
                  "Message" (T "Search.NoResultsMessage") 
                  "Icon" "fas fa-circle-info" 
                  "Dismissible" false 
                  "Live" "polite"
                )}}
                {{end}}
            </div>
        </div>
        {{end}}

        <!-- Error Messages -->
        {{if .Error}}
        <div class="card">
            <div class="card-content">
                {{template "notification" (dict 
                  "Type" "danger" 
                  "Message" .Error 
                  "Icon" "fas fa-exclamation-triangle" 
                  "Dismissible" true 
                  "Live" "assertive"
                )}}
            </div>
        </div>
        {{end}}
    </div>
</section>
{{end}}