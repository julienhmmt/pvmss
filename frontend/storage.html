{{define "storage"}}
<div class="container mt-4">

  {{if .Error}}
  <div class="notification is-danger">
    <p><strong>{{T "Common.Error"}}:</strong> {{.Error}}</p>
    <a href="/admin/storage" class="button is-small is-light mt-2">
      <span>{{T "Common.TryAgain"}}</span>
    </a>
  </div>
  {{else}}
  <div class="card admin-card">
    <header class="card-header brand-header is-align-items-center">
      <p class="card-header-title">
        <span class="icon"><i class="fas fa-hdd"></i></span>&nbsp;{{T "Admin.Storage.Title"}}
      </p>
    </header>
    <div class="card-content">
      <!-- Description integrated into card -->
      <p class="help mb-2">
        <span class="icon is-small has-text-grey-light mr-1"><i class="fas fa-info-circle"></i></span>
        {{T "Admin.Storage.Description"}}
      </p>
      <hr class="my-3">
      {{if .Storages}}
      <div class="table-container">
        <table class="table is-fullwidth is-striped is-hoverable is-narrow">
          <thead>
            <tr>
              <th scope="col">
                <span class="icon-text">
                  <span class="icon">
                    <i class="fas fa-toggle-on"></i>
                  </span>
                  <span>{{T "Admin.Storage.Header.Enabled"}}</span>
                </span>
              </th>
              <th scope="col">
                <span class="icon-text">
                  <span class="icon">
                    <i class="fas fa-hdd"></i>
                  </span>
                  <span>{{T "Admin.Storage.Header.Name"}}</span>
                </span>
              </th>
              <th scope="col">
                <span class="icon-text">
                  <span class="icon">
                    <i class="fas fa-tag"></i>
                  </span>
                  <span>{{T "Admin.Storage.Header.Type"}}</span>
                </span>
              </th>
              <th scope="col">
                <span class="icon-text">
                  <span class="icon">
                    <i class="fas fa-file-alt"></i>
                  </span>
                  <span>{{T "Admin.Storage.Header.Content"}}</span>
                </span>
              </th>
              <th scope="col">
                <span class="icon-text">
                  <span class="icon">
                    <i class="fas fa-database"></i>
                  </span>
                  <span>{{T "Admin.Storage.Header.Usage"}}</span>
                </span>
              </th>
              <th scope="col">
                <span class="icon-text">
                  <span class="icon">
                    <i class="fas fa-info-circle"></i>
                  </span>
                  <span>{{T "Admin.Storage.Header.Description"}}</span>
                </span>
              </th>
            </tr>
          </thead>
          <tbody>
            {{range $i, $storage := .Storages}}
            <tr>
              <td>
                {{/* Per-row form to toggle enable/disable without JS */}}
                <form method="POST" action="/admin/storage/toggle" class="is-inline">
                  <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                  <input type="hidden" name="storage" value="{{$storage.Storage}}">
                  <input type="hidden" name="action"
                    value="{{if index $.EnabledMap $storage.Storage}}disable{{else}}enable{{end}}">
                  <button type="submit"
                    class="button is-small {{if index $.EnabledMap $storage.Storage}}is-success is-light{{else}}is-light{{end}}"
                    aria-label="{{if index $.EnabledMap $storage.Storage}}{{T "Common.Disable"}}{{else}}{{T "Common.Enable"}}{{end}} {{$storage.Storage}}"
                    title="{{if index $.EnabledMap $storage.Storage}}{{T "Common.Disable"}}{{else}}{{T "Common.Enable"}}{{end}} {{$storage.Storage}}">
                    <span class="icon is-small">
                      <i
                        class="fas {{if index $.EnabledMap $storage.Storage}}fa-toggle-on{{else}}fa-toggle-off{{end}}"></i>
                    </span>
                  </button>
                </form>
              </td>
              <td>{{$storage.Storage}}</td>
              <td>
                <span class="tag {{if eq $storage.Type " dir"}}is-info{{else if eq $storage.Type "lvm"
                  }}is-warning{{else if eq $storage.Type "ceph" }}is-danger{{else}}is-light{{end}} is-light">
                  {{$storage.Type}}
                </span>
              </td>
              <td>
                <span class="tag is-light">{{$storage.Content}}</span>
              </td>
              <td>
                <div class="is-flex is-align-items-center">
                  <progress
                    class="progress {{if lt $storage.UsedPercent 70}}is-success{{else if lt $storage.UsedPercent 90}}is-warning{{else}}is-danger{{end}}"
                    style="width: 100px"
                    value="{{$storage.Used}}" max="{{$storage.Total}}"></progress>
                  <span class="is-size-7 ml-2">{{$storage.UsedPercent}}%</span>
                </div>
                <div class="is-size-7 has-text-grey">
                  {{$storage.Used | formatBytes}} / {{$storage.Total | formatBytes}}
                </div>
              </td>
              <td>{{$storage.Description}}</td>
            </tr>
            {{end}}
          </tbody>
        </table>
      </div>

      {{/* No bulk save button: auto-save per toggle */}}
      {{else}}
      <div class="notification is-warning">
        {{T "Admin.Storage.NoStorages"}}
      </div>
      {{end}}
    </div>
  </div>
  {{end}}
</div>
{{end}}