{{define "storage"}}
<div class="container mt-4">
  <h2 class="title is-4">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-hdd"></i>
      </span>
      <span>{{index .t "Admin.Storage.Title"}}</span>
    </span>
  </h2>
  
  <div class="notification is-light">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-info-circle"></i>
      </span>
      <span>{{index .t "Admin.Storage.Description"}}</span>
    </span>
  </div>

  {{if .Error}}
    <div class="notification is-danger">
      <p><strong>{{index .t "Common.Error"}}:</strong> {{.Error}}</p>
      <a href="/admin/storage" class="button is-small is-light mt-2">
        <span>{{index .t "Common.TryAgain"}}</span>
      </a>
    </div>
  {{else}}
      <div class="box">
        <h3 class="subtitle is-5 mb-3">{{index .t "Admin.Storage.AvailableStorages"}}</h3>
        
        {{if .Storages}}
          <div class="table-container">
            <table class="table is-fullwidth is-striped is-hoverable">
              <thead>
                <tr>
                  <th>
                    <span class="icon-text">
                      <span class="icon">
                        <i class="fas fa-toggle-on"></i>
                      </span>
                      <span>{{index .t "Admin.Storage.Header.Enabled"}}</span>
                    </span>
                  </th>
                  <th>
                    <span class="icon-text">
                      <span class="icon">
                        <i class="fas fa-hdd"></i>
                      </span>
                      <span>{{index .t "Admin.Storage.Header.Name"}}</span>
                    </span>
                  </th>
                  <th>
                    <span class="icon-text">
                      <span class="icon">
                        <i class="fas fa-tag"></i>
                      </span>
                      <span>{{index .t "Admin.Storage.Header.Type"}}</span>
                    </span>
                  </th>
                  <th>
                    <span class="icon-text">
                      <span class="icon">
                        <i class="fas fa-file-alt"></i>
                      </span>
                      <span>{{index .t "Admin.Storage.Header.Content"}}</span>
                    </span>
                  </th>
                  <th>
                    <span class="icon-text">
                      <span class="icon">
                        <i class="fas fa-database"></i>
                      </span>
                      <span>{{index .t "Admin.Storage.Header.Usage"}}</span>
                    </span>
                  </th>
                  <th>
                    <span class="icon-text">
                      <span class="icon">
                        <i class="fas fa-info-circle"></i>
                      </span>
                      <span>{{index .t "Admin.Storage.Header.Description"}}</span>
                    </span>
                  </th>
                </tr>
              </thead>
              <tbody>
                {{range $i, $storage := .Storages}}
                  <tr>
                    <td>
                      {{/* Per-row form to toggle enable/disable without JS */}}
                      <form method="POST" action="/admin/storage/toggle" style="display:inline">
                        <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                        <input type="hidden" name="storage" value="{{$storage.Storage}}">
                        <input type="hidden" name="action" value="{{if index $.EnabledMap $storage.Storage}}disable{{else}}enable{{end}}">
                        <button type="submit" class="button is-small {{if index $.EnabledMap $storage.Storage}}is-success{{else}}is-light{{end}}">
                          {{if index $.EnabledMap $storage.Storage}}
                            {{index $.t "Common.Disable"}}
                          {{else}}
                            {{index $.t "Common.Enable"}}
                          {{end}}
                        </button>
                      </form>
                    </td>
                    <td>{{$storage.Storage}}</td>
                    <td>
                      <span class="tag {{if eq $storage.Type "dir"}}is-info{{else if eq $storage.Type "lvm"}}is-warning{{else if eq $storage.Type "ceph"}}is-danger{{else}}is-light{{end}}">
                        {{$storage.Type}}
                      </span>
                    </td>
                    <td>
                      <span class="tag is-light">{{$storage.Content}}</span>
                    </td>
                    <td>
                      <div class="is-flex is-align-items-center" style="gap: 0.5rem;">
                        <progress 
                          class="progress {{if lt $storage.UsedPercent 70}}is-success{{else if lt $storage.UsedPercent 90}}is-warning{{else}}is-danger{{end}}" 
                          value="{{$storage.Used}}" 
                          max="{{$storage.Total}}"
                          style="width: 100px;"
                        ></progress>
                        <span>{{$storage.UsedPercent}}%</span>
                      </div>
                      <div class="is-size-7 has-text-grey">
                        {{$storage.Used | formatBytes}} / {{$storage.Total | formatBytes}}
                      </div>
                    </td>
                    <td>{{$storage.Description}}</td>
                  </tr>
                {{end}}
              </tbody>
            </table>
          </div>
          
          {{/* No bulk save button: auto-save per toggle */}}
        {{else}}
          <div class="notification is-warning">
            {{index .t "Admin.Storage.NoStorages"}}
          </div>
        {{end}}
      </div>
  {{end}}
</div>
{{end}}
