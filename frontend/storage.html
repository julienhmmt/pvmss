{{define "storage"}}
<h2 class="title is-4">{{index .t "Admin.Storage.Title"}}</h2>
<div class="notification is-light">
  {{index .t "Admin.Storage.Description"}}
</div>
<div id="storage-list" class="mb-4"></div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    if (window.storageInitialized) return;
    window.storageInitialized = true;

    const storageList = document.getElementById("storage-list");

    function fetchStorages() {
      fetch("/api/storage")
        .then((response) => response.json())
        .then((data) => {
          storageList.innerHTML = "";
          if (data.storages && data.storages.length > 0) {
            const table = document.createElement("table");
            table.className = "table is-fullwidth is-striped";

            const thead = document.createElement("thead");
            thead.innerHTML = `
              <tr>
                <th>{{index .t "Admin.Storage.Header.Name"}}</th>
                <th>{{index .t "Admin.Storage.Header.Type"}}</th>
                <th>{{index .t "Admin.Storage.Header.Content"}}</th>
              </tr>
            `;
            table.appendChild(thead);

            const tbody = document.createElement("tbody");
            data.storages.forEach((storage) => {
              const row = document.createElement("tr");
              row.innerHTML = `
                <td>${storage.name}</td>
                <td>${storage.type}</td>
                <td>${storage.content}</td>
              `;
              tbody.appendChild(row);
            });
            table.appendChild(tbody);

            storageList.appendChild(table);
          } else {
            storageList.innerHTML = '<p>{{index .t "Admin.Storage.NoStorages"}}</p>';
          }
        })
        .catch((error) => {
          console.error("Error fetching storages:", error);
          storageList.innerHTML = '<p>{{index . "Admin.Storage.Error"}}</p>';
        });
    }

    fetchStorages();
  });
</script>
{{end}}
