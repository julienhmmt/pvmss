{{define "vmbr"}}
<div class="container mt-4">
  <h2 class="title is-4">{{index .t "Admin.VMBR.Title"}}</h2>
  <div class="notification is-light">
    {{index .t "Admin.VMBR.Description"}}
  </div>

  {{if .Error}}
    <div class="notification is-danger">
      <p><strong>{{index .t "Common.Error"}}:</strong> {{.Error}}</p>
      <a href="/admin/vmbr" class="button is-small is-light mt-2">
        <span>{{index .t "Common.TryAgain"}}</span>
      </a>
    </div>
  {{else}}
      <div class="box">
        <h3 class="subtitle is-5 mb-3">{{index .t "Admin.VMBR.Title"}}</h3>
        
        {{if .VMBRs}}
          <div class="table-container">
            <table class="table is-fullwidth is-striped is-hoverable">
              <thead>
                <tr>
                  <th><span class="icon-text"><span class="icon"><i class="fas fa-toggle-on"></i></span> <span>{{index .t "Admin.VMBR.Header.Enabled"}}</span></span></th>
                  <th><span class="icon-text"><span class="icon"><i class="fas fa-server"></i></span> <span>{{index .t "Admin.VMBR.Header.Node"}}</span></span></th>
                  <th><span class="icon-text"><span class="icon"><i class="fas fa-network-wired"></i></span> <span>{{index .t "Admin.VMBR.Header.Name"}}</span></span></th>
                  <th><span class="icon-text"><span class="icon"><i class="fas fa-info-circle"></i></span> <span>{{index .t "Admin.VMBR.Header.Description"}}</span></span></th>
                </tr>
              </thead>
              <tbody>
                {{range $i, $vmbr := .VMBRs}}
                  {{/* Safely extract name from map to avoid nil in index */}}
                  {{$name := index $vmbr "iface"}}
                  <tr>
                    <td>
                      <form method="POST" action="/admin/vmbr/toggle" style="display:inline">
                        <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                        <input type="hidden" name="vmbr" value="{{$name}}">
                        <input type="hidden" name="action" value="{{if index $.EnabledVMBRs $name}}disable{{else}}enable{{end}}">
                        <button type="submit" class="button is-small {{if index $.EnabledVMBRs $name}}is-success{{else}}is-light{{end}}">
                          {{if index $.EnabledVMBRs $name}}
                            {{index $.t "Common.Disable"}}
                          {{else}}
                            {{index $.t "Common.Enable"}}
                          {{end}}
                        </button>
                      </form>
                    </td>
                    <td>{{$vmbr.node}}</td>
                    <td>{{$name}}</td>
                    <td>{{index $vmbr "description"}}</td>
                  </tr>
                {{end}}
              </tbody>
            </table>
          </div>
          
          {{/* No bulk save button: auto-save per toggle */}}
        {{else}}
          <div class="notification is-warning">
            {{index .t "Admin.VMBR.NoVMBRs"}}
          </div>
        {{end}}
      </div>
  {{end}}
</div>
{{end}}
