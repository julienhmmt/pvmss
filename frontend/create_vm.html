{{define "create_vm"}}
{{$lang := .Lang}}

<section class="section">
    <div class="container">
        <div class="hero is-primary is-small has-hero-bg">
            <div class="hero-body">
                <div class="container has-text-centered">
                    <h1 class="title is-2 has-text-white mb-2">
                        <span class="icon-text">{{index .t "VM.Create.Title"}}</span>
                    </h1>
                    <p class="subtitle has-text-white mb-2">
                        {{index .t "UI.CreateVMDescription"}}
                    </p>
                </div>
            </div>
        </div>
        <div class="columns is-centered">
            <div class="column is-10 welcome-block">
                <form method="POST" action="/api/vm/create" id="vmCreateForm">
                    <div class="columns is-multiline">
                        <!-- Left Column -->
                        <div class="column is-6">
                            <!-- Basic Information -->
                            <div class="box mb-5">
                                <h2 class="title is-5">{{index .t "VM.Create.BasicInfo"}}</h2>
                                <!-- VM Name -->
                                <div class="field">
                                    <label class="label">{{index .t "Common.Name"}}</label>
                                    <div class="control">
                                        <input class="input" type="text" name="name" 
                                               placeholder='{{index .t "VM.Create.VMNamePlaceholder"}}' required>
                                        <p class="help">{{index .t "VM.Create.VMNameHelp"}}</p>
                                    </div>
                                </div>
                                <!-- Description -->
                                <div class="field">
                                    <label class="label">{{index .t "VM.Create.Description"}}</label>
                                    <div class="control">
                                        <textarea class="textarea" name="description" placeholder='{{index .t "VM.Create.DescriptionPlaceholder"}}' rows="2"></textarea>
                                    </div>
                                </div>
                                <!-- VM ID -->
                                <div class="field">
                                    <label class="label">
                                        {{index .t "VM.Create.VMID"}}
                                    </label>
                                    <div class="control">
                                        <input class="input" type="number" name="vmid" min="100" max="999999999" placeholder='{{index .t "VM.Create.VMIDPlaceholder"}}'>
                                        <p class="help">{{index .t "VM.Create.VMID.Help"}}</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Resources -->
                            <div class="box mb-5">
                                <h2 class="title is-5">{{index .t "VM.Create.Resources"}}</h2>
                                <div class="columns">
                                    <!-- CPU Sockets -->
                                    <div class="column is-6">
                                        <div class="field">
                                            <label class="label">{{index .t "VM.Create.CPUSockets"}}</label>
                                            <div class="control">
                                                <div class="select is-fullwidth">
                                                    <select name="sockets" required>
                                                        {{range $i := until 5}}
                                                        <option value="{{$i}}" {{if eq $i 1}}selected{{end}}>{{$i}}</option>
                                                        {{end}}
                                                    </select>
                                                </div>
                                            </div>
                                    </div>
                                </div>

                                <!-- CPU Cores -->
                                <div class="column is-6">
                                    <div class="field">
                                        <label class="label">{{index .t "VM.Create.CPUCores"}}</label>
                                        <div class="control">
                                            <div class="select is-fullwidth">
                                                <select name="cores" required>
                                                    {{range $i := until 9}}
                                                    <option value="{{$i}}" {{if eq $i 1}}selected{{end}}>{{$i}}</option>
                                                    {{end}}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Memory -->
                            <div class="field">
                                <label class="label">{{index .t "Common.Memory"}}</label>
                                <div class="field has-addons">
                                    <div class="control is-expanded">
                                        <input class="input" type="number" name="memory" min="512" step="128" 
                                               value="2048" required>
                                    </div>
                                    <div class="control">
                                        <a class="button is-static">MB</a>
                                    </div>
                                </div>
                                <p class="help">{{index .t "VM.Create.MemoryHelp"}}</p>
                            </div>

                            <!-- Disk Size -->
                            <div class="field">
                                <label class="label">{{index .t "VM.Create.DiskSize"}}</label>
                                <div class="field has-addons">
                                    <div class="control is-expanded">
                                        <input class="input" type="number" name="disk_size" min="8" step="1" 
                                               value="32" required>
                                    </div>
                                    <div class="control">
                                        <a class="button is-static">GB</a>
                                    </div>
                                </div>
                                <p class="help">{{index .t "VM.Create.DiskSizeHelp"}}</p>
                            </div>
                        </div>
                    </div>  <!-- End Left Column -->

                    <!-- Right Column -->
                    <div class="column is-6">
                        <!-- Media & Network -->
                        <div class="box mb-5">
                            <h2 class="title is-5">{{index .t "VM.Create.MediaNetwork"}}</h2>

                            <!-- ISO Image -->
                            <div class="field">
                                <label class="label">
                                    {{index .t "VM.Create.ISOImage"}}
                                </label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select name="iso">
                                            <option value="">-- {{index .t "VM.Create.SelectISO"}} --</option>
                                            {{range .ISOs}}
                                            <option value="{{.Path}}">{{.Name}}</option>
                                            {{else}}
                                            <option disabled>{{index .t "VM.Create.NoISOsAvailable"}}</option>
                                            {{end}}
                                        </select>
                                    </div>
                                </div>
                                <p class="help">{{index .t "VM.Create.ISOImageHelp"}}</p>
                            </div>

                            <!-- Network Bridge -->
                            <div class="field">
                                <label class="label">{{index .t "VM.Create.Network"}}</label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select name="bridge" required>
                                            {{range .Bridges}}
                                            <option value="{{.}}" {{if eq . "vmbr0"}}selected{{end}}>{{.}}</option>
                                            {{else}}
                                            <option disabled>{{index .t "VM.Create.NoBridgesAvailable"}}</option>
                                            {{end}}
                                        </select>
                                    </div>
                                </div>
                                <p class="help">{{index .t "VM.Create.NetworkBridgeHelp"}}</p>
                            </div>
                        </div>

                        <!-- Tags -->
                        <div class="box mb-5">
                            <h2 class="title is-5">{{index .t "VM.Create.Tags"}}</h2>
                            
                            <div class="field">
                                <div class="control">
                                    <div class="field has-addons">
                                        <div class="control is-expanded">
                                            <input type="text" class="input" id="tagInput" placeholder='{{index .t "VM.Create.TagsPlaceholder"}}'>
                                        </div>
                                        <div class="control">
                                            <button type="button" id="addTagBtn" class="button is-primary">
                                                {{index .t "Common.Add"}}
                                            </button>
                                        </div>
                                    </div>
                                    <div id="tagsContainer" class="tags mt-2">
                                        <!-- Tags will be added here dynamically -->
                                    </div>
                                    <input type="hidden" name="tags" id="tagsInput">
                                </div>
                                <p class="help">{{index .t "VM.Create.TagsHelp"}}</p>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="box">
                            <div class="field is-grouped is-justify-content-flex-end">
                                <div class="control">
                                    <button type="reset" class="button is-light is-fullwidth">{{index .t "Common.Reset"}}</button>
                                </div>
                                <div class="control">
                                    <button type="submit" class="button is-primary is-fullwidth">{{index .t "Common.Create"}}</button>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- End Right Column -->
                </div>
            </form>
        </div>
    </div>
</section>

<!-- JavaScript pour la gestion des tags -->
<script src="/static/js/vm-create.js"></script>
{{end}}