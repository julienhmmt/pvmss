{{define "admin_vmbr"}}
  {{template "admin_base" .}}
{{end}}

{{define "admin_vmbr_section"}}
  {{$csrf := $.CSRFToken}}
  {{$enabledVMBRs := $.EnabledVMBRs}}
  <div class="container mt-4">

  {{if .Error}}
  {{template "notification" (dict 
    "Type" "danger" 
    "Title" (T "Common.Error") 
    "Message" .Error 
    "Icon" "fas fa-exclamation-triangle" 
    "Dismissible" true 
    "Light" false 
    "Action" (dict 
      "Link" "/admin/vmbr" 
      "Text" (T "Common.TryAgain") 
      "Icon" "fas fa-rotate-right" 
      "Type" "light")
  )}}
  {{else}}
  <div class="content mb-5">
    <h1 class="title is-4">
      <span class="icon"><i class="fas fa-network-wired"></i></span>
      <span>{{T "Admin.VMBR.Title"}}</span>
    </h1>
    <p class="subtitle is-6 has-text-grey">{{T "Admin.VMBR.Description"}}</p>
  </div>

  <!-- Network Cards Configuration -->
  <div class="box admin-box mb-5">
    <h2 class="title is-5 mb-4">
      <span class="icon"><i class="fas fa-sliders-h"></i></span>
      <span>{{T "Admin.VMBR.NetworkCardsConfig"}}</span>
    </h2>
    <form method="POST" action="/admin/vmbr/update-network-cards">
      <input type="hidden" name="csrf_token" value="{{$csrf}}">
      <div class="field">
        <label class="label">{{T "Admin.VMBR.MaxNetworkCards"}}</label>
        <div class="field has-addons">
          <div class="control is-expanded">
            <input type="number" name="max_network_cards" class="input is-medium" 
                   value="{{.MaxNetworkCards}}" 
                   min="1" max="10" required
                   aria-label="{{T "Admin.VMBR.MaxNetworkCards"}}">
          </div>
          <div class="control">
            <button type="submit" class="button is-primary is-medium">
              <span class="icon"><i class="fas fa-save"></i></span>
              <span>{{T "Common.Save"}}</span>
            </button>
          </div>
        </div>
        <p class="help">{{T "Admin.VMBR.MaxNetworkCardsHelp"}}</p>
      </div>
    </form>
  </div>
  
  {{if .VMBRs}}
  <div class="box admin-box">
    <div class="table-container">
      <table class="table modern is-fullwidth is-hoverable">
        <thead>
          <tr>
            <th>
              <span class="icon-text">
                <span class="icon is-small"><i class="fas fa-network-wired"></i></span>
                <span>{{T "Admin.VMBR.Title"}}</span>
              </span>
            </th>
            <th>{{T "Admin.VMBR.Header.Node"}}</th>
            <th>{{T "Admin.VMBR.Header.Description"}}</th>
            <th class="has-text-right">{{T "Common.Actions"}}</th>
          </tr>
        </thead>
        <tbody>
          {{range .VMBRs}}
          {{$name := index . "name"}}
          <tr>
            <td>
              <span class="has-text-weight-semibold">{{$name}}</span>
            </td>
            <td>
              <span class="tag is-light">
                <span class="icon is-small"><i class="fas fa-server"></i></span>
                <span>{{index . "node"}}</span>
              </span>
            </td>
            <td>
              {{if (index . "description")}}
                <span class="has-text-grey">{{index . "description"}}</span>
              {{else}}
                <span class="has-text-grey is-italic">{{T "VMDetails.NoDescription"}}</span>
              {{end}}
            </td>
            <td class="has-text-right">
              {{$isEnabled := index $enabledVMBRs $name}}
              <form method="POST" action="/admin/vmbr/toggle" class="is-inline">
                <input type="hidden" name="csrf_token" value="{{$csrf}}">
                <input type="hidden" name="vmbr" value="{{$name}}">
                <input type="hidden" name="action" value="{{if $isEnabled}}disable{{else}}enable{{end}}">
                <button type="submit" class="button is-small {{if $isEnabled}}is-success is-light{{else}}is-ghost{{end}}"
                  aria-label="{{if $isEnabled}}{{T "Common.Disable"}}{{else}}{{T "Common.Enable"}}{{end}} {{$name}}"
                  title="{{if $isEnabled}}{{T "Common.Disable"}}{{else}}{{T "Common.Enable"}}{{end}} {{$name}}">
                  <span class="icon is-small">
                    {{if $isEnabled}}
                      <i class="fas fa-toggle-on"></i>
                    {{else}}
                      <i class="fas fa-toggle-off"></i>
                    {{end}}
                  </span>
                  <span>{{if $isEnabled}}{{T "Common.Enabled"}}{{else}}{{T "Common.Disabled"}}{{end}}</span>
                </button>
              </form>
            </td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>
  </div>
  {{else}}
  <div class="box admin-box">
    {{template "notification" (dict 
      "Type" "warning" 
      "Message" (T "Admin.VMBR.NoVMBRs") 
      "Icon" "fas fa-circle-info" 
      "Dismissible" false 
    )}}
  </div>
  {{end}}
  {{end}}
  </div>
{{end}}

