{{define "admin_tags"}}
  {{template "admin_base" .}}
{{end}}

{{define "admin_tags_section"}}
<section class="section">
  <div class="container mt-4">

  <div class="content mb-5">
    <h1 class="title is-4"><span class="icon"><i class="fas fa-tags"></i></span>&nbsp;{{T "Admin.Tags.Title"}}</h1>
    <p class="subtitle is-6 has-text-grey">{{T "Admin.Tags.Description"}}</p>
  </div>

  <div class="box admin-box">
    <div class="toolbar mb-3">
      <form method="POST" action="/tags" class="is-flex is-align-items-center">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
        <div class="field has-addons mb-0">
          <div class="control is-expanded">
            <input type="text" id="new-tag" name="tag" class="input is-rounded" maxlength="50"
                   placeholder='Tag' required pattern="[a-zA-Z0-9_\-]+"
                   title="Only letters, numbers, hyphens, and underscores allowed">
          </div>
          <div class="control">
            <button type="submit" class="button is-primary is-rounded">
              <span class="icon"><i class="fas fa-plus"></i></span>
              <span>{{T "Admin.Tags.AddTag"}}</span>
            </button>
          </div>
        </div>
      </form>
    </div>

    {{if .Tags}}
    <div class="table-container">
      <table class="table is-fullwidth is-striped is-hoverable modern">
        <thead>
          <tr>
            <th>
              <div class="field has-addons mb-0 is-align-items-center">
                <div class="control">
                  <span class="icon-text">
                    <span class="icon is-small"><i class="fas fa-tag"></i></span>
                    <span>{{T "Admin.Tags.Header.Name"}}</span>
                  </span>
                </div>
                <div class="control">
                  {{if eq .SortOrder "asc"}}
                  <a href="/admin/tags?sort=desc{{if .FilterQuery}}&filter={{.FilterQuery}}{{end}}&lang={{$.Lang}}" 
                     class="button is-small is-ghost" title="Sort descending">
                    <span class="icon is-small"><i class="fas fa-sort-up"></i></span>
                  </a>
                  {{else}}
                  <a href="/admin/tags?sort=asc{{if .FilterQuery}}&filter={{.FilterQuery}}{{end}}&lang={{$.Lang}}" 
                     class="button is-small is-ghost" title="Sort ascending">
                    <span class="icon is-small"><i class="fas fa-sort-down"></i></span>
                  </a>
                  {{end}}
                </div>
              </div>
            </th>
            {{if .TagCounts}}
            <th>{{T "Admin.Tags.Header.Usage"}}</th>
            {{end}}
            <th class="has-text-right">{{T "Common.Actions"}}</th>
          </tr>
        </thead>
        <tbody>
          {{range .Tags}}
          <tr>
            <td>
              <span class="tag is-info is-light">{{.}}</span>
            </td>
            {{if $.TagCounts}}
            <td>
              {{$count := index $.TagCounts .}}
              {{if $count}}
                <span class="tag is-success is-light">{{$count}} VMs</span>
              {{end}}
            </td>
            {{else}}
            <td>
              <span class="tag is-light">0 VMs</span>
            </td>
            {{end}}
            <td class="has-text-right">
              {{if ne . "pvmss"}}
              <a href="/admin/tags/delete?tag={{.}}&lang={{$.Lang}}" class="button is-small is-danger is-outlined"
                 title='{{T "Admin.Tags.DeleteTag"}} "{{.}}"'>
                <span class="icon is-small"><i class="fas fa-trash"></i></span>
              </a>
              {{else}}
              <span class="tag is-light">{{T "Admin.Tags.DefaultTag"}}</span>
              {{end}}
            </td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>
    {{else}}
    <div class="notification is-info is-light">
      <div class="level is-mobile">
        <div class="level-left">
          <div class="level-item">
            <span class="icon has-text-info">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
          <div class="level-item">
            <p>{{T "Admin.Tags.NoTags"}}</p>
          </div>
        </div>
      </div>
    </div>
    {{end}}
  </div>
{{end}}

{{define "admin_tags_delete"}}
  {{template "admin_base" .}}
{{end}}

{{define "admin_tags_delete_section"}}
<section class="section">
  <div class="container mt-4">

  <div class="content mb-5">
    <h1 class="title is-4"><span class="icon"><i class="fas fa-tags"></i></span>&nbsp;{{T "Admin.Tags.Title"}}</h1>
    <p class="subtitle is-6 has-text-grey">{{T "Admin.Tags.Description"}}</p>
  </div>

  <div class="box admin-box">
    <div class="notification is-warning is-light">
      <div class="level is-mobile">
        <div class="level-left">
          <div class="level-item">
            <span class="icon has-text-warning">
              <i class="fas fa-exclamation-triangle"></i>
            </span>
          </div>
          <div class="level-item">
            <div>
              <strong>{{T "Admin.Tags.DeleteConfirmTitle"}}</strong>
              <p>{{T "Admin.Tags.DeleteConfirmMessage" .Tag}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="level">
      <div class="level-left">
        <div class="level-item">
          <span class="tag is-info is-large">{{.Tag}}</span>
        </div>
      </div>
      <div class="level-right">
        <div class="level-item">
          <form method="POST" action="/tags/delete" class="is-inline">
            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
            <input type="hidden" name="tag" value="{{.Tag}}">
            <button type="submit" class="button is-danger">
              <span class="icon"><i class="fas fa-trash"></i></span>
              <span>{{T "Common.Yes"}}</span>
            </button>
          </form>
        </div>
        <div class="level-item">
          <a href="{{withLang "/admin/tags" $.Lang}}" class="button">
            <span class="icon"><i class="fas fa-times"></i></span>
            <span>{{T "Common.No"}}</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</section>
{{end}}